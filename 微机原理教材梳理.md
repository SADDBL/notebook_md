# 微机原理



## 第二章 ==微处理器==的结构和工作模式

### 2.1 **8086**CPU的内部结构和存储器结构

#### 2.1.1 内部结构

由总线接口单元（BIU）和指令执行单元（EU）两部分组成。

```mermaid
classDiagram
	  8086CPU --|> EU_指令执行单元
      8086CPU --|> BIU_总线接口单元
      指令队列 --|> EU_指令执行单元
      BIU_总线接口单元 --|> 指令队列
      class 8086CPU{
          总线接口单元（BIU）
          指令执行单元（EU）
      }
      
      class EU_指令执行单元{
      	算术逻辑单元（ALU）
      	负责执行指令()
      }
      class BIU_总线接口单元{
      	16bit数据总线
      	20bit地址总线
      	负责从内存指定单元取出指令()
      	获取执行指令所需操作数()
      }
      class 指令队列{
      读指令
      读/写数据
      （1）地址计算()
	  （2）总线信号生成()

      }
      
```

#### 2.1.2 工作过程

1. 读存储器操作

   根据现行段地址寄存器CS和指令指针寄存器IP的值，在地址加法器$\sum$中形成20位物理地址：
   $$
   CS\times16(左移4位)+IP
   $$

#### 2.2.3 CPU内部寄存器

##### 1.数据寄存器

|      | 15   | 7    | 用途           | 功能                                       |
| ---- | ---- | ---- | :------------- | ------------------------------------------ |
| AX   | AH   | AL   | ==累加器==     | 使用最多、最频繁；在**乘除法**中有专门用途 |
| BX   | BH   | BL   | ==基址==寄存器 | 存放**偏移地址**                           |
| CX   | CH   | CL   | ==计数==寄存器 | 在循环操作时作**计数器**                   |
| DX   | DH   | DL   | ==数据==寄存器 | 在**乘除法88**和**I/O口**的操作中使用      |

##### 2.段寄存器

8086/8088CPU可直接寻址**1MB**的存储空间，需要20位地址信息。

CPU内部寄存器只有16位，因此采用**分段**技术解决，将1MB存储空间分成若干个**逻辑段**，每段长**64KB（16位）**。

| 段寄存器 |              |
| -------- | ------------ |
| CS       | 代码段寄存器 |
| DS       | 数据段寄存器 |
| SS       | 堆栈段寄存器 |
| ES       | 附加段寄存器 |

存放各段起始地址的**高16位值**。

##### 3. 地址指针和变址寄存器

| 地址指针和变址寄存器 |                |
| -------------------- | -------------- |
| SP                   | 堆栈指针寄存器 |
| BP                   | 基址指针寄存器 |
| SI                   | 源变址寄存器   |
| DI                   | 目的变址寄存器 |

存放段内地址偏移量（Offset）。

段基地址和段内偏移地址Offset组合得到20位物理地址。

##### 4.标志寄存器

| 标志位寄存器 |                |                                                              |
| ------------ | -------------- | ------------------------------------------------------------ |
| 0            | 进位标志CF     |                                                              |
| 2            | 奇偶校验位PF   | 也称**偶校验位**                                             |
| 4            | 辅助进位标志AF | 低4位向高4位借位或有进位，只在**BCD**码计算才有用，需要==减6调整== |
| 6            | 零标志ZF       |                                                              |
| 7            | 符号标志SF     |                                                              |
| 11           | 溢出标志OF     |                                                              |
| 8            | 陷阱标志TF     | TF=1，==单步工作==模式；TF=0，正常运行                       |
| 9            | 中断标志IF     | IF=1，运行CPU响应可**屏蔽中断**；执行STI指令可使IF置1，CLI指令使IF清0。 |
| 10           | 方向标志DF     |                                                              |

+ 正数/负数/BCD数由编程人员确定

+ 有符号数，查SF、OF

+ 无符号数，查CF

+ BCD数，查AF

+ 均查ZF、PF

##### 5.指令指针寄存器IP

程序运行时，每次CPU从代码段取出1字节指令，IP++。

IP值仅能由**BIU**自动修改，不能人为更改。
